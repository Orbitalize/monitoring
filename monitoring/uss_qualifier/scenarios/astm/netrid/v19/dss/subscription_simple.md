# ASTM NetRID DSS: Subscription Simple test scenario

## Overview

Perform basic operations on a single DSS instance to create, update and delete subscriptions.

## Resources

### dss

[`DSSInstanceResource`](../../../../../resources/astm/f3411/dss.py) to be tested in this scenario.

### id_generator

[`IDGeneratorResource`](../../../../../resources/interuss/id_generator.py) providing the Subscription IDs for this scenario.

### isa

[`ServiceAreaResource`](../../../../../resources/netrid/service_area.py) describing a service area for which to subscribe.

### problematically_big_area

[`VerticesResource`](../../../../../resources/vertices.py) describing an area designed to be too big to be accepted by the DSS.

## Setup test case

### Ensure clean workspace test step

This step ensures that no subscription with the known test ID exists in the DSS.

#### Ensure subscription with test ID does not exist check

If the DSS cannot be queried for the existing test ID, or if a subscription with that ID exists and it cannot be removed,
the DSS is likely not implementing **[astm.f3411.v19.DSS0030,e](../../../../../requirements/astm/f3411/v19.md)** or **[astm.f3411.v19.DSS0030,d](../../../../../requirements/astm/f3411/v19.md)** properly.

## Subscription Simple test case

This test case creates a subscription, goes on to query and search it in different ways, then deletes it and searches for it again.

### Create subscription validation test step

This test step creates a subscription and ensures that the subscription the DSS returned in the API call is correct and well-formed.

#### Create subscription check

As per **[astm.f3411.v19.DSS0030,c](../../../../../requirements/astm/f3411/v19.md)**, the DSS API must allow callers to create a valid subscription.

#### Returned subscription ID is correct check

If the returned subscription ID does not correspond to the one specified in the creation parameters,
**[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)** is not respected.

#### Returned notification index is 0 check

The notification index of a newly created subscription must be 0, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Returned ISA URL has correct base URL check

The returned ISA URL must be prefixed with the USS base URL that was provided at subscription creation, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Returned start time is correct check

The returned start time must be the same as the provided one, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Returned end time is correct check

The returned end time must be the same as the provided one, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Generated subscription version has proper format check

The subscription version generated by the DSS must be a lower-case alphanumeric string of 10 characters or more, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

### Query Existing Subscription test step

Query and search for the created subscription in various ways

#### Get Subscription by ID check

If the freshly created subscription cannot be queried using its ID, the DSS is failing to meet **[astm.f3411.v19.DSS0030,e](../../../../../requirements/astm/f3411/v19.md)**.

#### Search for all subscriptions in ISA area check

If the DSS fails to let us search in the area for which the subscription was just created, it is failing to meet **[astm.f3411.v19.DSS0030,f](../../../../../requirements/astm/f3411/v19.md)**.

#### Created Subscription is in search results check

If the created subscription is not returned in a search that covers the area it was created for, the DSS is not properly implementing **[interuss.f3411.dss_endpoints.SearchSubscriptions](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### No huge search area allowed check

In accordance with **[interuss.f3411.dss_endpoints.SearchSubscriptions](../../../../../requirements/interuss/f3411/dss_endpoints.md)**, the DSS should not allow searches for areas that are too big.

#### Returned subscription ID is correct check

If the returned subscription ID does not correspond to the one specified in the creation parameters,
**[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)** is not respected.

#### Returned notification index is equal to or greater than 0 check

If the notification index of the subscription is less than 0, the DSS fails to properly implement **[interuss.f3411.dss_endpoints.GetSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Returned ISA URL has correct base URL check

The returned ISA URL must be prefixed with the USS base URL that was provided at subscription creation, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Returned start time is correct check

The returned start time must be the same as the provided one, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Returned end time is correct check

The returned end time must be the same as the provided one, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Generated subscription version has proper format check

The subscription version generated by the DSS must be a lower-case alphanumeric string of 10 characters or more, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

### Delete Subscription test step

Attempt to delete the subscription in various ways and ensure that the DSS reacts properly.

This also checks that the subscription data returned by a successful deletion is correct.

#### Missing version prevents deletion check

An attempt to delete a subscription without providing a version should fail, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.DeleteSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Incorrect version prevents deletion check

An attempt to delete a subscription while providing an incorrect version should fail, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.DeleteSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Subscription can be deleted check

An attempt to delete a subscription when the correct version is provided should succeed, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.DeleteSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Returned subscription ID is correct check

If the returned subscription ID does not correspond to the one specified in the deletion request,
**[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)** is not respected.

#### Returned notification index is equal to or greater than 0 check

If the notification index of the subscription is less than 0, the DSS fails to properly implement **[interuss.f3411.dss_endpoints.GetSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Returned ISA URL has correct base URL check

The returned ISA URL must be prefixed with the USS base URL that was provided at subscription creation, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Returned start time is correct check

The returned start time must be the same as the provided one, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Returned end time is correct check

The returned end time must be the same as the provided one, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Generated subscription version has proper format check

The subscription version generated by the DSS must be a lower-case alphanumeric string of 10 characters or more, otherwise the DSS is in violation of **[interuss.f3411.dss_endpoints.PutSubscription](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

### Query Deleted Subscription test step

Attempt to query and search for the deleted subscription in various ways

#### Query by subscription ID should fail check

If the DSS provides a successful reply to a direct query for the deleted subscription, it is in violation of **[astm.f3411.v19.DSS0030,e](../../../../../requirements/astm/f3411/v19.md)**.

#### Search for all subscriptions in ISA area check

If the DSS fails to let us search in the area for which the subscription was just created, it is failing to meet **[astm.f3411.v19.DSS0030,f](../../../../../requirements/astm/f3411/v19.md)**.

#### Search area that represents a loop is not allowed check

The DSS should not allow us to search for subscriptions using a list of vertices describing a loop (first and last points in the list of vertices are the same),
otherwise it is failing to meet **[interuss.f3411.dss_endpoints.SearchSubscriptions](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

#### Deleted subscription should not be present in search results check

If the DSS returns the deleted subscription in a search that covers the area it was originally created for, the DSS is not properly implementing **[interuss.f3411.dss_endpoints.SearchSubscriptions](../../../../../requirements/interuss/f3411/dss_endpoints.md)**.

## Cleanup

The cleanup phase of this test scenario removes the subscription with the known test ID if it has not been removed before.

#### Ensure subscription with test ID does not exist check

If the DSS cannot be queried for the existing test ID, or if a subscription with that ID exists and it cannot be removed,
the DSS is likely not implementing **[astm.f3411.v19.DSS0030,e](../../../../../requirements/astm/f3411/v19.md)** or **[astm.f3411.v19.DSS0030,d](../../../../../requirements/astm/f3411/v19.md)** properly.
